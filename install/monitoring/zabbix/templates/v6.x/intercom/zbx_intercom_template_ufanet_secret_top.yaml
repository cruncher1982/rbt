zabbix_export:
  version: '6.4'
  template_groups:
    - uuid: a06c527d403f4d6d82938392b30b53ac
      name: Templates/Intercoms
  templates:
    - uuid: 05d3fea353894493b3196f092f7e5fdb
      template: Intercom_UFANET_SECRET_TOP
      name: 'Intercom | UFANET SECRET TOP by HTTP'
      description: 'Intercom UFANET SECRET TOP by HTTP panel monitoring'
      vendor:
        name: SmartYard
        version: 2025-04
      templates:
        - name: 'ICMP Ping'
      groups:
        - name: Templates/Intercoms
      items:
        - uuid: 3775732fcac84a20ba4f361340ce82bd
          name: 'UFANET SECRET TOP Intercom: fw version'
          type: HTTP_AGENT
          key: intercom.fwversion
          delay: 10m
          history: 7d
          trends: '0'
          value_type: TEXT
          authtype: BASIC
          username: '{$HOST_USERNAME}'
          password: '{$HOST_PASSWORD}'
          inventory_link: SOFTWARE
          preprocessing:
            - type: REGEX
              parameters:
                - 'version=([0-9.]+)'
                - \1
          url: 'http://{HOST.CONN}:85/cgi-bin/magicBox.cgi?action=getSoftwareVersion'
          triggers:
            - uuid: c2f094a1afba46f891bec034f8db694d
              expression: 'last(/Intercom_UFANET_SECRET_TOP/intercom.fwversion,#1)<>last(/Intercom_UFANET_SECRET_TOP/intercom.fwversion,#2) and length(last(/Intercom_UFANET_SECRET_TOP/intercom.fwversion))>0'
              name: 'Firmware version has changed'
              event_name: 'INTERCOM: {HOST.NAME} | Firmvare version has changed (new version: {ITEM.VALUE})'
              priority: INFO
              description: 'The firmware version has changed'
        - uuid: 3c4a6ba4084945cfb6294784938bed93
          name: 'UFANET SECRET TOP Intercom: SIP registration status'
          type: DEPENDENT
          key: intercom.sipstatus
          delay: '0'
          history: 7d
          trends: '0'
          value_type: TEXT
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.sipreg
          master_item:
            key: intercom.systeminfo
          triggers:
            - uuid: deb0b70b0bcd42ecb37ee90eb8e0a919
              expression: 'count(/Intercom_UFANET_SECRET_TOP/intercom.sipstatus,10m,,"0")>5'
              name: 'SIP: Registration failure'
              event_name: 'INTERCOM: {HOST.NAME} | SIP registration failure'
              priority: WARNING
              description: 'Check SIP registration on device more 10 minutes'
              dependencies:
                - name: 'Device has been restarted'
                  expression: last(/Intercom_UFANET_SECRET_TOP/intercom.uptime)<10m
        - uuid: 26426496f171414b988f3b495acefc3f
          name: 'UFANET SECRET TOP Intercom: system info'
          type: HTTP_AGENT
          key: intercom.systeminfo
          history: 1h
          trends: '0'
          value_type: TEXT
          authtype: BASIC
          username: '{$HOST_USERNAME}'
          password: '{$HOST_PASSWORD}'
          url: 'http://{HOST.CONN}:85/api/v1/status'
          follow_redirects: 'NO'
        - uuid: e6031733a16742f1906abe04c804cf2d
          name: 'UFANET SECRET TOP Intercom: uptime'
          type: DEPENDENT
          key: intercom.uptime
          delay: '0'
          value_type: FLOAT
          units: uptime
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.uptime
            - type: JAVASCRIPT
              parameters:
                - |
                  const parts = value.split(/\s+/);
                  const days = parseInt(parts[0]) || 0;
                  const timeParts = parts[2].split(':').map(Number);
                  const hours = timeParts[0];
                  const minutes = timeParts[1];
                  const seconds = timeParts[2];
                      
                  return days * 86400 + hours * 3600 + minutes * 60 + seconds;
          master_item:
            key: intercom.systeminfo
          triggers:
            - uuid: 176a0b9602e947048bafd4fbe5c5f8e9
              expression: last(/Intercom_UFANET_SECRET_TOP/intercom.uptime)<10m
              name: 'Device has been restarted'
              event_name: 'INTERCOM: {HOST.NAME} | has been restarted (uptime < 10m)'
              priority: INFO
      tags:
        - tag: class
          value: hardware
        - tag: target
          value: ufanet
      macros:
        - macro: '{$HOST_PASSWORD}'
          value: admin
          description: 'WEB GUI | API password, default value admin'
        - macro: '{$HOST_USERNAME}'
          value: admin
          description: 'WEB GUI | API username, default value admin'
  triggers:
    - uuid: 1310d677aa494d0fb720a6a55dc1fb60
      expression: 'nodata(/Intercom_UFANET_SECRET_TOP/intercom.systeminfo,600)=1 or nodata(/Intercom_UFANET_SECRET_TOP/intercom.fwversion,600)=1'
      name: 'HTTP: port/service unreachable (ICMP OK)'
      priority: WARNING
      description: 'HTTP Check unavailable but ICMP available'
